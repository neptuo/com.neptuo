
<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>(Semi) automatic Blazor publish to GitHub pages - Neptuo</title>

    <link rel="shortcut icon" type="image/x-icon" href="/Content/Images/favicon.png" />

    <link href="/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="/Content/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="/Content/featherlight.min.css" rel="stylesheet" />
    <link href="/Content/web.css" rel="stylesheet" />

    <link rel="alternate" type="application/rss+xml" title="Neptuo Blog" href="https://www.neptuo.com/blog/atom.xml" />
</head>
<body>

    <nav class="navbar navbar-fixed-top" role="navigation">
        <div class="container">
            <button class="navbar-toggle">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </button>

            <ul class="left">
                    <li>
        <a href="/">
            <div class="maintext">
                Home
                <span class="glyphicon glyphicon-home"></span>
            </div>
            <div class="subtext">How can we help you?</div>
        </a>
    </li>

            </ul>
            <ul class="right">
                    <li>
        <a href="/project">
            <div class="maintext">
                Projects
                <span class="glyphicon glyphicon-cloud"></span>
            </div>
            <div class="subtext">Projects we are working on</div>
        </a>
    </li>

                    <li>
        <a href="/service">
            <div class="maintext">
                Services
                <span class="glyphicon glyphicon-globe"></span>
            </div>
            <div class="subtext">Our services and references</div>
        </a>
    </li>

                    <li class="active">
        <a href="/blog">
            <div class="maintext">
                Blog
                <span class="glyphicon glyphicon-bookmark"></span>
            </div>
            <div class="subtext">Thoughts to share</div>
        </a>
    </li>

            </ul>
        </div>
    </nav>

    <div class="body">
        <form>

            

<div class="intro important blogpost">
    <div class="intro-content container">
        <h1>(Semi) automatic Blazor publish to GitHub pages</h1>
        <p>
            
      How to make your life easier by automating publish
    
        </p>
    </div>
</div>


<div class="container">
    <div class="folder blogpost">
        <p>GitHub pages is a solid solution for hosting static sites. I use it a lot and as a matter of fact, my very first blog post was about running this site on GitHub pages. I host all of my Blazor wasm apps on GitHub pages. Until recently I was always publishing them manually. You know, build my code, copy content of publish folder to a folder with checkout of the GitHub pages repo, and finally commit.</p>
<p>But! It is very easy to use GitHub actions to do this tedious process on my behalf. Here is my approach.</p>
<p>I always have a separate repo for GitHub pages. For example I have <a target="_blank" class="external-link" href="https://github.com/maraf/Money">maraf/Money</a> repo with sources and then I have (two) repos for static sites <a target="_blank" class="external-link" href="https://github.com/maraf/com.neptuo.money.app">maraf/com.neptuo.money.app</a> and <a target="_blank" class="external-link" href="https://github.com/maraf/com.neptuo.money.app.beta">maraf/com.neptuo.money.app.beta</a>.</p>
<p>In each of these static site repos I have created a GitHub actions workflow file <a target="_blank" class="external-link" href="https://github.com/maraf/com.neptuo.money.app/blob/master/.github/workflows/deploy.yml">deploy.yaml</a>. As mentioned in the title, I use semi-automatic approach, as I want to have a control over what gets published where. I configured the workflow to be triggered manually using <code>workflow_dispatch</code>.</p>
<h2>Step 0: Input arguments</h2>
<p>I want to have the ability to select which commit gets published, so I configured the <code>workflow_dispatch</code> to accept one optional argument</p>
<pre><code>inputs:
    commitHash:
    description: 'Commit hash'
    type: string
</code></pre>
<p>If the argument is not provided, it takes the head of the repo.</p>
<h2>Step 1: Checkout</h2>
<p>I use <code>actions/checkout@v3</code> and as I need to checkout a different repo than the current one, it needs a bit configuration</p>
<pre><code>- name: Checkout
  uses: actions/checkout@v3 
  with:
    repository: 'maraf/Money'
    ref: '${{ inputs.commitHash }}'
</code></pre>
<h2>Step 2: Setup .NET</h2>
<p>This one is straightforward</p>
<pre><code>- name: Setup .NET
  uses: actions/setup-dotnet@v3
  with:
    dotnet-version: '7.0.x'
</code></pre>
<h2>Step 3: Install wasm-tools (optional)</h2>
<p>I want to publish an AOT compiled version, so I need workload <code>wasm-tools</code></p>
<pre><code>- name: Install wasm-tools
  run: dotnet workload install wasm-tools
</code></pre>
<h2>Step 4: Build the code</h2>
<p>Again, pretty straightforward. Compile my Blazor project in Release configuration, with AOT and put it in the <code>./artifacts</code> folder. The <code>-p:PublishDomain</code> is my way of generating <code>CNAME</code> file for GitHub pages. You can check it out in the <a target="_blank" class="external-link" href="https://github.com/maraf/Money/blob/master/src/Money.Blazor.Host/Money.Blazor.Host.csproj#L49-L74">Money.Blazor.Host.csproj</a>.</p>
<pre><code>- name: Build
  run: dotnet publish ./src/Money.Blazor.Host/Money.Blazor.Host.csproj -c Release -p:PublishDomain=app.money.neptuo.com -p:RunAOTCompilation=true -o ./artifacts
</code></pre>
<h2>Step 4: Deploy to GitHub pages</h2>
<p>Here I'm using <code>JamesIves/github-pages-deploy-action@v4</code> action to do it. There are quite some alternatives, but this one worked for me. It allows me to select which folder deploy to which branch, without need for explicit authentication token (since I'm publishing to the current repo).</p>
<pre><code>- name: Deploy to GitHub Pages
  if: success()
  uses: JamesIves/github-pages-deploy-action@v4
  with:
    folder: ./artifacts/wwwroot
    branch: master
</code></pre>
<h2>Summary</h2>
<p>And that's it. It's 30 lines of code that simplifies my life when publishing new version for my Blazor apps. No idea why it took me so long.</p>

    </div>

    <div class="folder">
        <div class="left">
            Posted on 2022-12-10
        </div>
        <div class="right">
            Written by <a target="_blank" rel="nofollow" href="https://github.com/maraf">Maraf</a>
        </div>
        <div class="clear"></div>
    </div>

        <div class="folder">
            <div class="comment-heading">
                <h3>
                    <span class="hidden">Comments</span>
                    <span class="glyphicon glyphicon-comment"></span>
                </h3>
            
                To leave a comment, please sign-in at GitHub and
                <a href="https://github.com/neptuo/com.neptuo/issues/55" target="_blank">
                    comment on the issue associated with this post.
                </a>
            </div>
            <div id="comments"></div>
        </div>
</div>




        </form>
    </div>

    <footer>
        <div class="container">
            <div class="left">
                <span>Neptuo &copy; 2010 - 2016</span>
                
            </div>
            <div class="right">
                <span>Created by <a target="_blank" href="https://mara.neptuo.com">Marek Fi≈°era</a></span>
                
            </div>
            <div class="center">
                
    <span><a href="/blog/atom.xml">Atom</a></span>

            </div>
            <div class="clear"></div>
        </div>
    </footer>

    <script src="/Scripts/jquery-1.9.1.js"></script>
    <script src="/Scripts/featherlight.min.js"></script>
    <script>

        function onSwitcherClicked(e) {
            var folder = this.parentElement.parentElement;
            folder.classList.toggle('folder-collapsed');
        }

        var switchers = document.querySelectorAll('.folder-switch');
        for (var i = 0; i < switchers.length; i++) {
            var switcher = switchers[i];
            switcher.addEventListener('click', onSwitcherClicked);
        }

        var navbarToggle = document.querySelector("button.navbar-toggle");
        if (navbarToggle != null) {
            navbarToggle.addEventListener('click', function (e) {
                var navbar = document.querySelector("nav");
                navbar.classList.toggle('navbar-expanded');
            });
        }

    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-12031460-1', 'auto');
    </script>
        <script>
            ga('send', 'pageview');
        </script>
    

        <script src="/Scripts/blogcomments.js"></script>
        <script>

            load("https://api.github.com/repos/neptuo/com.neptuo/issues/55/comments");

        </script>

    <script type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://www.neptuo.com",
        "logo": "/Content/Images/Logo-220.png"
        }
    </script>
    <!-- <img src="/Content/Images/favicon.png" /> -->
</body>
</html>