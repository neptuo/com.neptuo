
<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>WPF and design-time data - Neptuo</title>
    
    <link rel="shortcut icon" type="image/x-icon" href="/Content/Images/favicon.png" />

    <link href="/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="/Content/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="/Content/web.css" rel="stylesheet" />

    <link rel="alternate" type="application/rss+xml" title="Neptuo Blog" href="https://www.neptuo.com/blog/atom.xml" />
</head>
<body>

    <nav class="navbar navbar-fixed-top" role="navigation">
        <div class="container">
            <button class="navbar-toggle">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </button>

            <ul class="left">
                    <li>
        <a href="/">
            <div class="maintext">
                Home
                <span class="glyphicon glyphicon-home"></span>
            </div>
            <div class="subtext">How can we help you?</div>
        </a>
    </li>

            </ul>
            <ul class="right">
                    <li>
        <a href="/project">
            <div class="maintext">
                Projects
                <span class="glyphicon glyphicon-cloud"></span>
            </div>
            <div class="subtext">Projects we are working on</div>
        </a>
    </li>

                    <li>
        <a href="/service">
            <div class="maintext">
                Services
                <span class="glyphicon glyphicon-globe"></span>
            </div>
            <div class="subtext">Our services and references</div>
        </a>
    </li>

                    <li class="active">
        <a href="/blog">
            <div class="maintext">
                Blog
                <span class="glyphicon glyphicon-bookmark"></span>
            </div>
            <div class="subtext">Thoughts to share</div>
        </a>
    </li>

            </ul>
        </div>
    </nav>

    <div class="body">
        <form>

            

<div class="intro important blogpost">
    <div class="intro-content container">
        <h1>WPF and design-time data</h1>
        <p>
            
      There are various to ways to accomplish this goal: Show some data in the designer for WPF view. Here I&#39;m going to describe the one that works the best for me.
    
        </p>
    </div>
</div>


<div class="container">
    <div class="folder blogpost">
        <h2>ViewModelLocator.cs</h2>
<p>Every WPF project I start with a simple static class where I'm going to place a static property for every root view model I need for design-time data binding.</p>
<div class="highlight csharp"><pre>

<span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="identifier">ViewModelLocator</span>
{
    <span class="keyword">private</span> <span class="keyword">static</span> MainViewModel <span class="identifier">main</span>;

    <span class="keyword">public</span> <span class="keyword">static</span> MainViewModel <span class="identifier">Main</span>
    {
        <span class="keyword">get</span> 
        {
            <span class="keyword">if</span> (main == <span class="constant">null</span>)
            {
                main = <span class="keyword">new</span> MainViewModel(<span class="keyword">new</span> MockService1(), <span class="keyword">new</span> MockService2());
            }

            <span class="keyword">return</span> main;
        }
    }
}


</pre></div>
<h2>XAML</h2>
<p>Than in WPF view, I just use <code>DataContext</code> from <code>http://schemas.microsoft.com/expression/blend/2008</code> to bind to this static property during design-time.</p>
<div class="highlight xml"><pre>

&lt;<span class="element">Window</span> <span class="attribute">x:Class</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">MainWindow</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns:x</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/winfx/2006/xaml</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns:mc</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.openxmlformats.org/markup-compatibility/2006</span><span class="quot">&quot;</span> 
    <span class="attribute">xmlns:d</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/expression/blend/2008</span><span class="quot">&quot;</span> 
    <span class="attribute">xmlns:dd</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">clr-namespace:Project.DesignData</span><span class="quot">&quot;</span>
    <span class="attribute">mc:Ignorable</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">d</span><span class="quot">&quot;</span> <span class="attribute">d:DataContext</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">{x:Static dd:ViewModelLocator.Main}</span><span class="quot">&quot;</span>&gt;


</pre></div>
<blockquote>
<p>Also, the important part is to use <code>mc</code> to ignore <code>d</code> namespace in runtime.</p>
</blockquote>
<h2>Enable project code</h2>
<p>For this approach to work, designer must have 'Enable project code' enabled.</p>
<p><img src="/Content/Images/Blog/wpf-design-data/enable-project-code.png" alt="Enable project code" /></p>
<h2>UWP</h2>
<p>UWP doesn't support <code>x:Static</code>, but a slightly modified approach works as well.</p>
<ol>
<li>Remove static from the <code>ViewModelLocator</code>.</li>
<li>In <code>App.xaml</code> create an instance.</li>
</ol>
<div class="highlight xml"><pre>

&lt;<span class="element">Application</span> <span class="attribute">xmlns:dd</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">using:Project.DesignData</span><span class="quot">&quot;</span>&gt;
    &lt;<span class="element">Application.Resources</span>&gt;
        &lt;<span class="element">dd</span><span class="string">:</span><span class="element">ViewModelLocator</span> <span class="attribute">x:Key</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">ViewModelLocator</span><span class="quot">&quot;</span> <span class="string">/&gt;</span>

    ...


</pre></div>
<ol start="3">
<li>Use <code>Source</code> property of <code>{Binding}</code> extension.</li>
</ol>
<div class="highlight xml"><pre>

&lt;<span class="element">Page</span>
    <span class="attribute">x:Class</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">MainPage</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns:x</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/winfx/2006/xaml</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns:d</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.microsoft.com/expression/blend/2008</span><span class="quot">&quot;</span>
    <span class="attribute">xmlns:mc</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">http://schemas.openxmlformats.org/markup-compatibility/2006</span><span class="quot">&quot;</span>
    <span class="attribute">mc:Ignorable</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">d</span><span class="quot">&quot;</span> <span class="attribute">d:DataContext</span><span class="string">=</span><span class="quot">&quot;</span><span class="string">{Binding Main, Source={StaticResource ViewModelLocator}}</span><span class="quot">&quot;</span>&gt;


</pre></div>
<h2>Simplify property definition inside ViewModelLocator.</h2>
<p>After years of using this approach and being bored with the definition of static lazy instantiated property, I have created a simple helper.
It uses <code>Dictionary</code> and behaves a slightly poor performant, but that isn't a concern for design-time support.</p>
<p>With the boilerplate code and a little help of newer C# syntax, you can get to a single line of code for each view model.</p>
<div class="highlight csharp"><pre>

<span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="identifier">ViewModelLocator</span>
{
    <span class="keyword">#region</span> Infrastructure

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;<span class="keyword">object</span>, <span class="keyword">object</span>&gt; storage = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">object</span>, <span class="keyword">object</span>&gt;();

    <span class="keyword">private</span> <span class="keyword">static</span> T <span class="identifier">Get</span>&lt;T&gt;(Func&lt;T&gt; factory)
    {
        <span class="keyword">object</span> key = factory.Method.GetHashCode();
        <span class="keyword">if</span> (!storage.TryGetValue(key, <span class="keyword">out</span> <span class="keyword">object</span> instance))
            storage[key] = instance = factory();

        <span class="keyword">return</span> (T)instance;
    }

    <span class="keyword">#endregion</span>

    <span class="keyword">public</span> <span class="keyword">static</span> IService1 <span class="identifier">Services1</span> =&gt; Get(() =&gt; <span class="keyword">new</span> MockService1());

    <span class="keyword">public</span> <span class="keyword">static</span> MainViewModel <span class="identifier">Main</span> =&gt; Get(() =&gt; <span class="keyword">new</span> MainViewModel(Service1));
}


</pre></div>
<h2>Summary</h2>
<p>It's very easy approach and inside <code>ViewModelLocator</code> properties you can code any logic needed to initialize your model.
The only drawback is that you need to define interfaces to provide fakes/mocks for your services passed to view models.</p>
<p>In 'Build History' Visual Studio extension I have also used a <code>System.Threading.Tasks</code> to animate progress in time inside WPF designer.</p>
<h2>Examples</h2>
<ul>
<li><a href="https://github.com/maraf/GitExtensions.PluginManager/tree/master/src/PackageManager.UI/Views">WPF</a>.</li>
<li><a href="https://github.com/maraf/Money/tree/master/src/Money.UI.Universal/Views">UWP</a>.</li>
<li><a href="https://github.com/neptuo/Productivity/tree/master/src/Neptuo.Productivity.BuildHistory/UI/Views">VSIX with animation</a>.</li>
</ul>

    </div>

    <div class="folder">
        <div class="left">
            Posted on 2019-04-21
        </div>
        <div class="right">
            Written by <a target="_blank" rel="nofollow" href="https://github.com/maraf">Maraf</a>
        </div>
        <div class="clear"></div>
    </div>

</div>




        </form>
    </div>

    <footer>
        <div class="container">
            <div class="left">
                <span>Neptuo &copy; 2010 - 2016</span>
                
            </div>
            <div class="right">
                <span>Created by <a target="_blank" href="https://mara.neptuo.com">Marek Fi≈°era</a></span>
                
            </div>
            <div class="center">
                
    <span><a href="/blog/atom.xml">Atom</a></span>

            </div>
            <div class="clear"></div>
        </div>
    </footer>

    <script>

        function onSwitcherClicked(e) {
            var folder = this.parentElement.parentElement;
            folder.classList.toggle('folder-collapsed');
        }

        var switchers = document.querySelectorAll('.folder-switch');
        for (var i = 0; i < switchers.length; i++) {
            var switcher = switchers[i];
            switcher.addEventListener('click', onSwitcherClicked);
        }

        var navbarToggle = document.querySelector("button.navbar-toggle");
        if (navbarToggle != null) {
            navbarToggle.addEventListener('click', function (e) {
                var navbar = document.querySelector("nav");
                navbar.classList.toggle('navbar-expanded');
            });
        }

    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-12031460-1', 'auto');
    </script>
        <script>
            ga('send', 'pageview');
        </script>
    


    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "http://www.neptuo.com",
            "logo": "/Content/Images/Logo-220.png"
        }
    </script>
</body>
</html>